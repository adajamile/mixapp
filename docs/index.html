<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Projeto MeMO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#9fb0cf; --text:#eaf0ff;
      --accent:#6ea8fe; --accent2:#a78bfa; --ok:#34d399; --err:#f87171;
      --radius:16px; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --gap:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:#0b1220;color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:1024px;margin:0 auto;padding:22px}

    /* cards de playlist */
    .pp-group{margin-bottom:10px}
    .pp-title{font-weight:700;margin:4px 0 6px}
    .pp-tracks{display:grid;gap:8px}
    .pp-item{display:flex;align-items:center;gap:10px;padding:8px;border:1px solid rgba(255,255,255,.12);border-radius:10px;background:#0f1627;cursor:pointer}
    .pp-item:hover{border-color:rgba(255,255,255,.25)}
    .pp-item .name{flex:1}
    .pp-item .len{opacity:.8;font-size:.9rem}
    .pp-item.active{outline:2px solid var(--accent); background:linear-gradient(135deg,rgba(110,168,254,.12),rgba(167,139,250,.12))}

    /* Header (Op√ß√£o B) */
    .header{display:flex;align-items:center;gap:12px;padding:8px 0 6px}
    .brand{display:inline-grid;place-items:center;text-decoration:none}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .titles h1{margin:0;font-size:28px}
    .titles .sub{margin:4px 0 0;color:var(--muted)}
    @media (max-width:640px){
      .header{flex-direction:column;align-items:flex-start;gap:8px}
      .logo{width:56px;height:56px}
      .titles h1{font-size:26px}
    }

    section{scroll-margin-top:80px; margin: var(--gap) 0;}
    .card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);backdrop-filter:blur(4px)}
    .grid{display:grid;gap:14px}
    .two{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type="text"],input[type="number"]{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#0f1627;color:var(--text)}
    input::placeholder{color:#a8b7d3}
    .btn{appearance:none;border:1px solid transparent;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b1220}
    .btn.secondary{background:transparent;color:var(--text);border-color:rgba(255,255,255,.25)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .muted{color:var(--muted);font-size:.95rem}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .tog{display:flex;align-items:center;gap:10px;margin-top:8px}
    .switch{position:relative;width:52px;height:30px;background:#1b253b;border-radius:999px;border:1px solid rgba(255,255,255,.15);cursor:pointer}
    .switch::after{content:"";position:absolute;top:2px;left:2px;width:26px;height:26px;background:#fff;border-radius:50%;transition:.18s}
    .switch.on{background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .switch.on::after{left:24px}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .controls .btn{min-width:88px}
    .seek{display:flex;align-items:center;gap:8px}
    footer{color:#9fb0cf;text-align:center;padding:18px 0}

    /* nav por pontos */
    .navdots{position:fixed;right:16px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:10px;z-index:50}
    .dot{width:12px;height:12px;border-radius:50%;background:#3a4461;border:2px solid #7084b3;cursor:pointer;transition:.2s}
    .dot.active{background:linear-gradient(135deg,var(--accent),var(--accent2));border-color:#cdd9ff}

    .hero{display:flex;gap:14px;align-items:center;margin:6px 0 14px}

    /* Galeria masonry (sem corte) */
    .gallery{column-count:1; column-gap:12px;}
    @media (min-width:640px){ .gallery{column-count:2;} }
    @media (min-width:980px){ .gallery{column-count:3;} }
    .gallery figure{break-inside:avoid; margin:0 0 12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:8px}
    .gallery img{width:100%; height:auto; display:block; border-radius:10px}
    figcaption{font-size:.9rem;color:#cfe0ff;margin-top:6px}
    .embedBox{aspect-ratio:16/9;width:100%;background:#0f1627;border:1px solid rgba(255,255,255,.12);border-radius:12px;display:grid;place-items:center;overflow:hidden}
    .embedBox iframe{width:100%;height:100%;border:0}
    .kpi{font-family:ui-monospace,Menlo,Consolas,monospace;color:#cfe0ff}
  </style>
</head>
<body>
  <!-- Pontinhos -->
  <div class="navdots">
    <div class="dot active" data-target="#proto" title="Prot√≥tipo"></div>
    <div class="dot" data-target="#spotify" title="Playlist do Spotify"></div>
    <div class="dot" data-target="#sobre" title="O que √© o projeto"></div>
    <div class="dot" data-target="#patro" title="Patrocinadores"></div>
    <div class="dot" data-target="#binaural" title="Ondas binaurais"></div>
    <div class="dot" data-target="#galeria" title="Galeria"></div>
  </div>

  <div class="wrap">
    <header class="header">
      <a href="#" class="brand" title="Voltar ao topo">
        <img src="assets/logo-memo.png" alt="Logo Projeto MeMO" class="logo" onerror="this.style.display='none'">
      </a>
      <div class="titles">
        <h1>Projeto MeMO</h1>
        <p class="sub">
          Bem-vindo ao site do <b>Projeto MeMO</b>! Aqui voc√™ encontra informa√ß√µes sobre nossa pesquisa,
          pode explorar a <b>Onda Binaural</b> j√° dispon√≠vel, misturar com <b>m√∫sicas</b>, acessar playlists do Spotify
          e conhecer mais sobre o projeto e sua equipe.
        </p>
      </div>
    </header>

    <!-- PROT√ìTIPO (limpo + onda travada) -->
    <section id="proto" class="card">
      <div class="hero"><h2 style="margin:0">Prot√≥tipo</h2></div>

      <div class="grid two">
        <div>
          <label>M√∫sicas do Projeto (selecione)</label>
          <div id="playlistPicker" class="card" style="padding:10px">
            <!-- JS renderiza aqui -->
          </div>
          <p class="muted">As faixas s√£o hospedadas em <code>assets/musicas/</code>.</p>
        </div>

        <!-- Onda Binaural travada -->
        <div class="card" style="display:flex;gap:10px;align-items:center;background:rgba(255,255,255,.04)">
          <div style="font-size:22px">üîí</div>
          <div>
            <div><b>Onda Binaural</b> (fixa)</div>
            <div class="muted" style="font-size:.9rem">assets/audio_binauralbeat.mp3</div>
          </div>
          <div style="margin-left:auto">
            <button id="binauralOnlyBtn" class="btn secondary">Ouvir Onda</button>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <button id="normalizeBtn" class="btn">Preparar (offline)</button>
        <span id="normStatus" class="muted"></span>
      </div>

      <hr style="border-color:rgba(255,255,255,.1);margin:14px 0">

      <div class="controls">
        <button id="playBtn" class="btn">‚ñ∂ Play</button>
        <button id="pauseBtn" class="btn secondary">‚è∏ Pause</button>
        <button id="stopBtn" class="btn secondary">‚èπ Stop</button>
        <div class="seek">
          <label for="seekSec" class="muted">Ir para (s)</label>
          <input id="seekSec" type="number" value="0" step="1" />
          <button id="seekBtn" class="btn secondary">Ir</button>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div class="tog">
          <div>M√∫sica</div>
          <div id="togA" class="switch on" title="Ativar/Desativar M√∫sica"></div>
        </div>
        <div class="tog">
          <div>Onda Binaural</div>
          <div id="togB" class="switch on" title="Ativar/Desativar Onda"></div>
        </div>
      </div>

      <p class="muted" style="margin-top:10px">
        Tempo: <span id="timeView">0.00</span>s ¬∑ Estado: <span id="stateView">idle</span>
      </p>
    </section>

    <!-- SPOTIFY -->
    <section id="spotify" class="card">
      <h2 style="margin-top:0">Playlist do Spotify</h2>
      <p class="muted">
        Cole a URL da playlist para visualizar no player oficial.
        Observa√ß√£o: o volume do player do Spotify √© controlado pelo pr√≥prio Spotify/OS.
        Em breve: importa√ß√£o de pr√©vias de 30s com volume inicial em 16%.
      </p>

      <div class="grid two">
        <div>
          <label>URL da playlist do Spotify</label>
          <input id="spUrl" type="text" placeholder="https://open.spotify.com/playlist/..." />
        </div>
        <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
          <button id="spShowBtn" class="btn">Mostrar playlist</button>
          <button id="spImportBtn" class="btn secondary" disabled>Importar pr√©vias (em breve)</button>
        </div>
      </div>

      <div class="embedBox" style="margin-top:12px"><iframe id="spEmbed" allow="encrypted-media"></iframe></div>
      <div id="spList" class="grid" style="margin-top:12px"></div>
      <p class="muted" id="spHint">Em breve: importar pr√©vias de 30s para misturar com a Onda.</p>
    </section>

    <!-- SOBRE -->
    <section id="sobre" class="card">
      <h2 style="margin-top:0">O que √© o Projeto MeMO</h2>
      <p class="muted">
        O Projeto MeMO investiga como <b>ondas binaurais</b> ‚Äì est√≠mulos sonoros com duas frequ√™ncias ligeiramente diferentes em cada ouvido ‚Äì
        podem contribuir como interven√ß√£o <b>acess√≠vel, n√£o invasiva e de baixo custo</b> para apoiar cuidados na Doen√ßa de Alzheimer.
        Em testes iniciais com c√©lulas H4, observamos ind√≠cios de redu√ß√£o na express√£o de genes associados √† DA (APP, BACE e MAPT).
        Pr√≥ximos passos incluem estudos com EEG em pacientes e o uso de IA para entender melhor os mecanismos envolvidos.
      </p>
    </section>

    <!-- PATROCINADORES -->
    <section id="patro" class="card">
      <h2 style="margin-top:0">Apoio e Patrocinadores</h2>
      <p class="muted">Obrigado a todos que apoiam o Projeto MeMO.</p>
      <img src="assets/fotos/memo institui√ß√µes de apoio.png" alt="Apoiadores" style="max-width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.1)" onerror="this.style.display='none'">
    </section>

    <!-- BINAURAL EXPLICA√á√ÉO -->
    <section id="binaural" class="card">
      <h2 style="margin-top:0">O que s√£o Ondas Binaurais?</h2>
      <p class="muted">
        Ondas binaurais s√£o um efeito auditivo: cada ouvido recebe uma frequ√™ncia levemente diferente e o c√©rebro interpreta a diferen√ßa como uma <b>batida r√≠tmica</b>.
        Estudos exploram como faixas espec√≠ficas ‚Äî <b>delta</b> (sono profundo), <b>theta</b> (relaxamento), <b>alpha</b> (calma e foco) e <b>beta</b> (aten√ß√£o ativa) ‚Äî podem influenciar o humor, a concentra√ß√£o ou o relaxamento.
        Seu uso √© <b>simples, opcional e consciente</b>.
      </p>
    </section>

    <!-- GALERIA -->
    <section id="galeria" class="card">
      <h2 style="margin-top:0">Galeria</h2>
      <div class="gallery" id="gallery"></div>
      <p class="muted">As imagens s√£o carregadas de <code>docs/assets/fotos/</code>. O layout em colunas evita cortes e respeita a altura de cada foto.</p>
    </section>

    <footer>Feito com üíô pelo Projeto MeMO</footer>
  </div>

  <!-- players invis√≠veis -->
  <audio id="audioA" crossorigin="anonymous"></audio>
  <audio id="audioB" crossorigin="anonymous"></audio>

  <script>
    // === CAT√ÅLOGO DE PLAYLISTS LOCAIS (nomes sem espa√ßo/acentos) ===
    const PLAYLISTS = [
      {
        title: "Playlists do Projeto",
        tracks: [
          { name: "Hits 2000‚Äì2010",   url: "assets/musicas/2010-2000s_playlist.mp3",        len: "‚âà45 min" },
          { name: "Arctic Monkeys",   url: "assets/musicas/arctic_monkeys_playlist.mp3",    len: "‚âà40 min" },
          { name: "M√∫sicas do Brasil",url: "assets/musicas/musicas_do_brasil_playlist.mp3", len: "‚âà50 min" },
          { name: "Rock Rom√¢ntico",   url: "assets/musicas/rock_romantico_playlist.mp3",    len: "‚âà42 min" },
        ]
      }
    ];

    // === CONFIGS ===
    const B_REF = -16.0, DELTA_DB = 45.0;          // alvos LUFS (B = -16; A = -61)
    const BINAURAL_SRC = "assets/audio_binauralbeat.mp3";

    // Elementos
    const els = {
      normalizeBtn: document.getElementById('normalizeBtn'),
      binauralOnlyBtn: document.getElementById('binauralOnlyBtn'),
      normStatus: document.getElementById('normStatus'),
      playBtn: document.getElementById('playBtn'),
      pauseBtn: document.getElementById('pauseBtn'),
      stopBtn: document.getElementById('stopBtn'),
      seekSec: document.getElementById('seekSec'),
      seekBtn: document.getElementById('seekBtn'),
      toggles: { A: document.getElementById('togA'), B: document.getElementById('togB') },
      timeView: document.getElementById('timeView'),
      stateView: document.getElementById('stateView'),
      audioA: document.getElementById('audioA'),
      audioB: document.getElementById('audioB'),
      gallery: document.getElementById('gallery'),
      spUrl: document.getElementById('spUrl'),
      spShowBtn: document.getElementById('spShowBtn'),
      spImportBtn: document.getElementById('spImportBtn'),
      spEmbed: document.getElementById('spEmbed'),
      spList: document.getElementById('spList'),
      spHint: document.getElementById('spHint'),
    };

    // playlist picker
    let selectedUrlA = "";
    function renderPlaylistPicker(){
      const host = document.getElementById('playlistPicker');
      host.innerHTML = "";
      PLAYLISTS.forEach((pl, gi)=>{
        const group = document.createElement('div'); group.className = "pp-group";
        const title = document.createElement('div'); title.className = "pp-title"; title.textContent = pl.title;
        const list = document.createElement('div'); list.className = "pp-tracks";
        pl.tracks.forEach((t, ti)=>{
          const row = document.createElement('div'); row.className = "pp-item"; row.dataset.g = gi; row.dataset.t = ti;
          row.innerHTML = `<div class="name">${t.name}</div><div class="len">${t.len||""}</div>`;
          row.addEventListener('click', ()=>{
            host.querySelectorAll(".pp-item").forEach(i=>i.classList.remove("active"));
            row.classList.add("active");
            selectedUrlA = t.url;
          });
          list.appendChild(row);
        });
        group.appendChild(title); group.appendChild(list);
        host.appendChild(group);
      });
    }

    // WebAudio graph
    let ctx, srcA, srcB, gainA, gainB, comp, rafId=null;
    function ensureCtx(){ if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); }
    function buildGraph(){
      ensureCtx();
      try{ srcA?.disconnect(); srcB?.disconnect(); gainA?.disconnect(); gainB?.disconnect(); comp?.disconnect(); }catch{}
      if (!srcA) srcA = ctx.createMediaElementSource(els.audioA);
      if (!srcB) srcB = ctx.createMediaElementSource(els.audioB);
      if (!gainA) gainA = ctx.createGain();
      if (!gainB) gainB = ctx.createGain();

      // volumes base (offline, sem normaliza√ß√£o LUFS)
      const BASE_VOL_MUSICA   = 0.12; // 12% m√∫sica
      const BASE_VOL_BINAURAL = 0.20; // 20% onda

      gainA.gain.value = (els.toggles.A.classList.contains('on') ? 1 : 0) * BASE_VOL_MUSICA;
      gainB.gain.value = (els.toggles.B.classList.contains('on') ? 1 : 0) * BASE_VOL_BINAURAL;

      comp = ctx.createDynamicsCompressor();
      comp.threshold.value = -3; comp.ratio.value = 3; comp.attack.value=.01; comp.release.value=.25;
      srcA.connect(gainA).connect(comp); srcB.connect(gainB).connect(comp);
      comp.connect(ctx.destination);
    }
    function tick(){
      if(!els.audioA.paused || !els.audioB.paused){
        els.timeView.textContent = Math.min(els.audioA.currentTime||0, els.audioB.currentTime||0).toFixed(2);
        rafId = requestAnimationFrame(tick);
      }
    }

    // Carrega as duas trilhas diretamente do GitHub Pages (sem backend/FFmpeg)
    async function normalizeBoth(){
      const urlA = selectedUrlA?.trim?.() || "";
      if(!urlA){
        showErr("Escolha uma faixa nas playlists do Projeto.");
        return;
      }

      // fontes diretas (sem normaliza√ß√£o LUFS)
      els.audioA.src = urlA;                 // m√∫sica (docs/assets/musicas/...)
      els.audioB.src = BINAURAL_SRC;         // onda fixa (docs/assets/audio_binauralbeat.mp3)

      // monta/atualiza a cadeia WebAudio e define volumes base
      buildGraph();

      // dica visual
      showOk("Pronto (sem normaliza√ß√£o)");
      setState('ready');
      tick();
    }

    async function playAll(){ ensureCtx(); await ctx.resume?.(); els.audioA.play().catch(()=>{}); els.audioB.currentTime=els.audioA.currentTime; els.audioB.play().catch(()=>{}); setState('playing'); tick(); }
    function pauseAll(){ els.audioA.pause(); els.audioB.pause(); setState('paused'); }
    function stopAll(){ els.audioA.pause(); els.audioB.pause(); els.audioA.currentTime=0; els.audioB.currentTime=0; els.timeView.textContent='0.00'; setState('stopped'); }
    function seekAll(sec){ sec=Math.max(0,Number(sec)||0); els.audioA.currentTime=sec; els.audioB.currentTime=sec; }

    // alternadores
    function toggle(el){
      el.classList.toggle('on'); if(!ctx) return;
      // manter o mesmo balanceamento base j√° aplicado no buildGraph()
      const BASE_VOL_MUSICA   = 0.12;
      const BASE_VOL_BINAURAL = 0.20;
      if(el===els.toggles.A) gainA.gain.value = (el.classList.contains('on')?1:0) * BASE_VOL_MUSICA;
      if(el===els.toggles.B) gainB.gain.value = (el.classList.contains('on')?1:0) * BASE_VOL_BINAURAL;
    }

    // Spotify (somente embed)
    function parsePlaylistId(u){
      try{
        const url = new URL(u);
        if (!/spotify\.com/.test(url.host)) return null;
        const parts = url.pathname.split("/").filter(Boolean);
        const i = parts.indexOf("playlist");
        if (i>=0 && parts[i+1]) return parts[i+1].split("?")[0];
        return null;
      }catch{ return null; }
    }
    function showSpotifyEmbed(){
      const id = parsePlaylistId(els.spUrl.value.trim());
      if(!id){ els.spEmbed.src=""; alert("URL de playlist inv√°lida."); return; }
      els.spEmbed.src = `https://open.spotify.com/embed/playlist/${id}?utm_source=generator`;
    }

    // Helpers de UI
    function showOk(msg){ els.normStatus.innerHTML = `<span class="ok">${msg}</span>`; }
    function showErr(msg){ els.normStatus.innerHTML = `<span class="err">${msg}</span>`; }
    function setState(s){ els.stateView.textContent = s; }

    // Eventos
    document.getElementById('normalizeBtn').addEventListener('click', normalizeBoth);
    document.getElementById('binauralOnlyBtn').addEventListener('click', async ()=>{
      els.audioB.src = BINAURAL_SRC;
      buildGraph();
      try{ ensureCtx(); await ctx.resume?.(); await els.audioB.play(); setState('binaural-only'); tick(); }catch{}
    });
    document.getElementById('playBtn').addEventListener('click', playAll);
    document.getElementById('pauseBtn').addEventListener('click', pauseAll);
    document.getElementById('stopBtn').addEventListener('click', stopAll);
    document.getElementById('seekBtn').addEventListener('click', ()=>seekAll(els.seekSec.value));
    document.getElementById('togA').addEventListener('click', ()=>toggle(els.toggles.A));
    document.getElementById('togB').addEventListener('click', ()=>toggle(els.toggles.B));
    document.getElementById('spShowBtn').addEventListener('click', showSpotifyEmbed);

    // Pontinhos
    const dots = [...document.querySelectorAll('.dot')];
    dots.forEach(d=>d.addEventListener('click',()=>{ document.querySelector(d.dataset.target)?.scrollIntoView({behavior:'smooth'}); }));
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          dots.forEach(d=>d.classList.toggle('active', d.dataset.target === '#'+e.target.id));
        }
      });
    },{root:null,threshold:.4});
    document.querySelectorAll('section').forEach(s=>obs.observe(s));

    // Galeria
    const fotos = [
      {file:"memo apresenta√ß√£o no workshop inovaneuro.png", caption:"Apresenta√ß√£o no Workshop InovaNeuro"},
      {file:"memo febrace.png", caption:"Finalistas na FEBRACE"},
      {file:"memo premiacao febrace.png", caption:"Premia√ß√£o ‚Äì 4¬∫ lugar em Biol√≥gicas"},
      {file:"memo ada com as celulas h4.png", caption:"Cultura de C√©lulas H4 ‚Äì laborat√≥rio"},
      {file:"memo isa com microscopio.png", caption:"Microscopia ‚Äì an√°lise de amostras"},
      {file:"memo no laborat√≥rio.png", caption:"Rotina de laborat√≥rio"},
      {file:"memo ada isa roberto de jalecos no laboratorio com mascara.png", caption:"Equipe no LCCA/UFAM"},
      {file:"memo ada isa de jaleco no laboratorio com mascara.png", caption:"Dupla no laborat√≥rio"},
      {file:"memo ada isa e roberto fora do lab ja sem mascaras.png", caption:"Equipe ‚Äì momento p√≥s-lab"},
      {file:"memo institui√ß√µes de apoio.png", caption:"Apoio institucional ao Projeto MeMO"}
    ];
    const gal = document.getElementById('gallery');
    fotos.forEach(({file,caption})=>{
      const fig = document.createElement('figure');
      const img = document.createElement('img'); img.src = `assets/fotos/${file}`; img.alt = caption;
      img.onerror = ()=> fig.style.display='none';
      const cap = document.createElement('figcaption'); cap.textContent = caption;
      fig.appendChild(img); fig.appendChild(cap); gal.appendChild(fig);
    });

    // Inicializa√ß√£o
    window.addEventListener("load", ()=>{
      els.audioB.src = BINAURAL_SRC;
      buildGraph();
      renderPlaylistPicker();
    });
  </script>
</body>
</html>
